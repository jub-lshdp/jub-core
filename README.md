# Jub Core


## Getting started

We must create the ```Catalog``` object before creating a new ```Observatory```:

```python
class Catalog(BaseModel):
    cid:str = ""
    display_name:str = ""
    items: List[CatalogItem] = []
    kind:str = ""
class CatalogItem(BaseModel):
    value:str
    display_name:str
    code:int
    description:str
    metadata:Dict[str,str]
````

An catalog has many items with the ```CatalogItem``` object definition. You can create an new ```Catalog``` using the oca client, we can create a new oca client using the next code:

```python
from jub.core import JubCoreClient
client = JubCoreClient(hostname="localhost",port=5000)
```
⚠️ remember to deploy an instance of oca api the step by step guide is [here](https://github.com/muyal-research-group/oca_api)


Using this instance of ```OCAClient```, we can create a ```Catalog``` object:

```python
from jub.core import JubCoreClient
from jub.core.model import Catalog
# Edit the attributes as you need
catalog = Catalog(
    cid="",
    display_name="",
    items= [
        CatalogItem(
            value="",
            display_name="",
            code=0,
            description="", 
            metadata={
               
            }
        )
    ],
    kind="SOME"
)
response = client.create_catalog(
    catalog = catalog
)
response.is_ok # => if True the creation was successfully
```

Now we are ready to create main object in this model, an  ```Observatory``` defined as follows:
```python
class Observatory(BaseModel):
    obid:str                    = ""
    title: str                  = ""
    image_url:str               = ""
    description:str             = ""
    catalogs:List[LevelCatalog] = []
    disabled:bool               = False
```

An observatory can contains many catalogs, expressed in the form of a list of catalogs  ```catalogs:List[LevelCatalog]```  in the ```Observatory``` object definition:

```python
class LevelCatalog(BaseModel):
    level: int
    cid: str
```
we can create an ```Observatory``` using the client:

```python
from jub.core import JubCoreClient
from jub.core.model import Observatory,LevelCatalog

# edit the attribute as you need..
observatory = Observatory(
    obid        = ""
    title       = ""
    image_url   = ""
    description = ""
    catalogs    = [
        LevelCatalog(
            level = 0,
            cid="firstcatalog"
        )
    ]
    disabled    = False
)

client.create_observatory(observatory = observatory)
```

⚠️ The attribute ```disabled``` manage the visibility of the observatory object, you can disabled and this observatory disappers without deleting the object. 

Finally we have object definition of the ```Product```: 

```python
class Product(BaseModel):
    pid:str=""
    description:str=""
    levels:List[Level]=[]
    product_type: str=""
    level_path:str=""
    profile:str=""
    product_name: str=""
    tags:List[str]=[]
    url:str =""
class Level(BaseModel):
    index:int
    cid:str
    value:str
    kind:str =""

```

we can create multiples products using the next method:
```python
from jub.core.model import Product, Level

products = [
     Product(
                pid="product1",
                description="Some description",
                level_path="iz33bpdsfepc3jejsgfll.producttypex",
                levels=[
                    Level(
                        index=0,
                        cid="iz33bpdsfepc3jejsgfll",
                        value="C00",
                        kind="INTEREST"
                    ),
                    Level(
                        index=1,
                        cid="producttypex",
                        value="MAP",
                        kind="INTEREST"
                    )
                ],
                product_name="Product 1",
                profile="C00.MAP",
                product_type="PRODUCT",
            )    
            # .....
]

response = client.create_products(
    products = products
)
```






## Prerequisites 

You only gonna need the next python library:
```sh
pip install -i https://test.pypi.org/simple/ goca==0.0.2
```

and for package managing and distribution install ```Poetry``` [here](https://python-poetry.org/):

```sh
pip3 install poetry
```

## Example

This guide walks you through the basic steps to create an observatory, add a catalog to it, and finally populate it with products.

The scripts must be run in order, as each step depends on the IDs generated by the previous one.

### Prerequisites

-   Python 3.9+
-   Required Python libraries (e.g., `poetry install`)



### Step 1: Create an Observatory

Run the first script to create a new observatory.

```bash
python3 examples/01_create_observatory.py
```
You will get an output similar to this. **Copy the Observatory ID** for the next step.
```
Observatory created with ID: 0efc85253ba54359b4482cf70e1cf730
```

### Step 2: Create a Catalog
Now, run the second script, passing the **Observatory ID** you just copied as an argument.

```bash
# Replace <Observatory-ID> with your actual ID
python3 examples/02_create_catalog.py <Observatory-ID>
```

Example:
```bash
python3 examples/02_create_catalog.py 0efc85253ba54359b4482cf70e1cf730
```

The script will output a new Catalog ID. **Copy the Catalog ID** for the final step.

```bash
Catalog created with ID: sex3fb25a076cf021f2 Updating observatory catalogs.. Ok('0fec85253ba54359b4482cf70e1cf730')
```

### Step 3: Create Products
Finally, run the third script, passing both the **Observatory ID** (from Step 1) and the **Catalog ID** (from Step 2).

```bash
# Replace <Observatory-ID> and <Catalog-ID>
python3 examples/03_create_products.py <Observatory-ID> <Catalog-ID>
```

Example:

```bash
python3 examples/03_create_products.py 0fec85253ba54359b4482cf70e1cf730 sex3fb25a076cf021f2
```

## Development

For development purposes you need to clone this repo:

```sh
git clone git@github.com:jub-lshdp/jub-core.git
```

After you clonning the repo, you must navigate to the ```jub-core``` folder:
```sh
cd jub-core
```

Now you should activating the virtualenv:

```sh
poetry shell
```

Then you should install the dependencies:
```sh
poetry install
```

Now you can run the test in the ````tests/``` folder: 

```sh
python3 tests/oca_test.sh
```

⚠️ Please check the ```oca_file.py``` after run to skip manually some of the tests.


## Building and Publishing

When you are done with the features you need to build the project: 

```sh
poetry build
```

Then you should execute the next command:

```sh
poetry publish -r ocatestpypi
```

:warning: Before publishing you must set up the tokens in the ```~/.config/pypoetry/auth.toml``` path. 



## Contributing

Contributions are what make the open source community such an amazing place to learn, inspire, and create. Any contributions you make are **greatly appreciated**.

If you have a suggestion that would make this better, please fork the repo and create a pull request. You can also simply open an issue with the tag "enhancement".
Don't forget to give the project a star! Thanks again!

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

<p align="right">(<a href="#top">back to top</a>)</p>



<!-- LICENSE -->
## License

Distributed under the MIT License. See `LICENSE.txt` for more information.

<p align="right">(<a href="#top">back to top</a>)</p>



<!-- CONTACT -->
## Contact

 Ignacio Castillo - [@NachoCastillo]() - jesus.castillo.b@cinvestav.mx

<p align="right">(<a href="#top">back to top</a>)</p>






